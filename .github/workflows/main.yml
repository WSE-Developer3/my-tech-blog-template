# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      # Runs a single command using the runners shell
      - name: Run a one-line script
        run: echo Hello, world!

      # Runs a set of commands using the runners shell
      - name: Run a multi-line script
        env:
          SSH_KEY: ${{ secrets.XSERVER_SSH_KEY }}
          USER_NAME: ${{ secrets.XSERVER_USER_NAME }}
          HOST_NAME: ${{ secrets.XSERVER_HOST_NAME }}
          PORT: 10022
        run: |
          # echo Add other actions to build,
          # echo test, and deploy your project.
          # echo "lss"
          ls 
          # echo "$XSERVER_SSH_KEY"
          # echo $XSERVER_SSH_KEY
          # echo ${USER_NAME}
          # 定数定義
          # PORT=10022 # ポート番号
          # COPY_FROM=$SCRIPT_DIR/out/* # コピー対象ファイル
          COPY_FROM=./out/* # コピー対象ファイル
          REMOTE_ROOT_DIR=$USER_NAME@$HOST_NAME:/home/$USER_NAME/ #リモートパス
          PROJECT_DIR=paths-are.com/public_html/works.paths-are.com/paths-are-tech-blog-template/ # プロジェクトまでのパス
          COPY_TO=$REMOTE_ROOT_DIR$PROJECT_DIR # コピー先

          # コピー先のファイルを全て削除
          echo "コピー先 $COPY_TO 配下のファイルを全て削除します。"
          ssh -i ${SSH_KEY} -l ${USER_NAME} -p ${PORT} ${USER_NAME}.xsrv.jp "rm -r $PROJECT_DIR*" #コピー先のフォルダ配下のファイルを削除
          echo "削除完了。"

          # 一括アップロード
          echo "$COPY_FROM のファイルを $COPY_TO へアップロードします。"
          scp -i ${SSH_KEY} -r -P $PORT $COPY_FROM $COPY_TO
          echo "ファイルのアップロードを完了しました。"
          echo "your site url : https://works.paths-are.com/paths-are-tech-blog-template"
          read -p "Press [Enter] key to resume."

